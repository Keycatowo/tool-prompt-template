<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt 模板填入工具</title>
    <link rel="icon" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3e%3cpath d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/%3e%3c/svg%3e" type="image/svg+xml">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3e%3cpath d='M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z'/%3e%3c/svg%3e">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EP1WXB46KZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EP1WXB46KZ');
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: 600;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .template-title {
            color: #2d3748;
            font-size: 1.2rem;
            font-weight: 500;
            margin: 0;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-reset-header {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-reset-header:hover {
            background: linear-gradient(45deg, #3182ce, #2c5282);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .edit-template-btn {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .edit-template-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.4);
        }

        .template-display {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            min-height: 100px;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 25px;
        }

        .placeholder {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            display: inline-block;
            margin: 0 3px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .placeholder:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        .filled {
            background: linear-gradient(45deg, #48bb78, #38a169);
            animation: fillAnimation 0.3s ease;
        }

        @keyframes fillAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .section {
            margin-bottom: 25px;
        }

        .section h2 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .format-note {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #9a3412;
        }

        .format-tabs {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            background: #f8fafc;
            padding: 6px;
            gap: 4px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            text-align: center;
        }

        .tab-btn:hover {
            background: #e2e8f0;
            color: #334155;
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
            font-weight: 600;
        }

        .tab-content {
            padding: 25px;
            min-height: 100px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .format-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .format-btn {
            background: white;
            border: 2px solid #e2e8f0;
            color: #4a5568;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .format-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .format-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            color: #667eea;
        }

        .format-btn:hover::before {
            left: 100%;
        }

        .format-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .format-btn.active:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
            transform: translateY(-2px);
            color: white;
        }

        @media (max-width: 768px) {
            .tab-buttons {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .tab-btn {
                font-size: 12px;
                padding: 10px 12px;
            }
            
            .format-buttons {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 10px;
            }
            
            .format-btn {
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .chatgpt-button-group {
                grid-column: 1 / -1;
                order: -1;
            }

            .btn-model-selector {
                position: relative;
                width: 100%;
                height: auto;
                border-radius: 8px;
                margin-top: 5px;
            }

            .chatgpt-button-group .btn-chatgpt {
                border-radius: 8px;
                margin-right: 0;
            }
        }

        .added-format {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 8px 0;
            font-size: 14px;
            color: #234e52;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .remove-format {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: #f56565;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-format:hover {
            background: #e53e3e;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        .btn-chatgpt {
            background: linear-gradient(45deg, #10a37f, #0d8b6b);
            color: white;
        }

        .btn-chatgpt:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.4);
        }

        .chatgpt-button-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            position: relative;
        }

        .chatgpt-button-group .btn-chatgpt {
            border-radius: 8px 0 0 8px;
            margin-right: 0;
        }

        .btn-model-selector {
            background: linear-gradient(45deg, #0d8b6b, #0a7557);
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-size: 12px;
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-model-selector:hover {
            background: linear-gradient(45deg, #0a7557, #086145);
        }

        .model-selector-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
            min-width: 120px;
        }

        .model-selector-dropdown.show {
            display: block;
        }

        .model-option {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 1px solid #eee;
        }

        .model-option:last-child {
            border-bottom: none;
        }

        .model-option:hover {
            background: #f5f5f5;
        }

        .model-option.selected {
            background: #10a37f;
            color: white;
        }

        .selected-model-display {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 2px;
        }

        .btn-copy {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
        }

        .btn-copy:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .btn-reset {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
        }

        .btn-reset:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.4);
        }

        .btn-clear {
            background: linear-gradient(45deg, #f56565, #e53e3e);
            color: white;
        }

        .btn-clear:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
        }

        /* Modal 樣式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal h3 {
            margin-top: 0;
            color: #2d3748;
            font-size: 1.3rem;
        }

        .modal input, .modal textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin: 15px 0;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .modal textarea {
            min-height: 120px;
            max-height: none;
            resize: vertical;
            overflow-y: hidden;
        }

        .modal input:focus, .modal textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            font-weight: 500;
            max-width: 300px;
            word-wrap: break-word;
        }

        .notification.show {
            transform: translateX(0);
        }

        .example {
            background: #f0f4f8;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .example h4 {
            margin: 0 0 10px 0;
            color: #2d3748;
        }

        .example code {
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .url-share-section {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .url-share-section h4 {
            margin: 0 0 8px 0;
            color: #0c4a6e;
            font-size: 1rem;
        }

        .btn-share {
            background: linear-gradient(45deg, #0ea5e9, #0284c7);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-share:hover {
            background: linear-gradient(45deg, #0284c7, #0369a1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
        }

        .empty-template {
            text-align: center;
            color: #a0aec0;
            font-style: italic;
            padding: 40px;
        }

        .example-selector {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .example-selector h4 {
            margin: 0 0 10px 0;
            color: #0c4a6e;
            font-size: 1rem;
        }

        .example-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e7ff;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .example-selector select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .example-selector select:hover {
            border-color: #c7d2fe;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📝 Prompt 模板填入工具</h1>
        
        <div class="template-header">
            <h2 class="template-title">📋 點擊下方標籤進行填入</h2>
            <div class="header-buttons">
                <button class="btn-reset-header" onclick="resetTemplate()">🔄 重置填入</button>
                <button class="edit-template-btn" onclick="openTemplateEditor()">✏️ 編輯模板</button>
            </div>
        </div>

        <div class="template-display" id="templateDisplay">
            <div class="empty-template">
                請點擊「編輯模板」開始設定你的 prompt 模板...
            </div>
        </div>

        <div class="section">
            <h2>🎨 快速添加格式要求</h2>
            
            <div class="format-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('output')">📊 輸出格式</button>
                    <button class="tab-btn" onclick="switchTab('length')">📏 長度控制</button>
                    <button class="tab-btn" onclick="switchTab('structure')">🏗️ 結構要求</button>
                    <button class="tab-btn" onclick="switchTab('style')">🎯 語言風格</button>
                    <button class="tab-btn" onclick="switchTab('special')">📋 特殊要求</button>
                </div>
                
                <div class="tab-content">
                    <div class="tab-panel active" id="tab-output">
                        <div class="format-buttons">
                            <button class="format-btn" onclick="addFormat('請將結果以表格形式輸出。')">表格格式</button>
                            <button class="format-btn" onclick="addFormat('請將結果以條列式呈現。')">條列清單</button>
                            <button class="format-btn" onclick="addFormat('請將結果以 JSON 格式輸出。')">JSON格式</button>
                            <button class="format-btn" onclick="addFormat('請以段落形式詳細說明。')">段落說明</button>
                        </div>
                    </div>
                    
                    <div class="tab-panel" id="tab-length">
                        <div class="format-buttons">
                            <button class="format-btn" onclick="addFormat('請以不超過 50 字簡潔回答。')">50字內</button>
                            <button class="format-btn" onclick="addFormat('請以不超過 100 字說明。')">100字內</button>
                            <button class="format-btn" onclick="addFormat('請提供詳細完整的分析。')">詳細分析</button>
                            <button class="format-btn" onclick="addFormat('請提供重點摘要。')">重點摘要</button>
                        </div>
                    </div>
                    
                    <div class="tab-panel" id="tab-structure">
                        <div class="format-buttons">
                            <button class="format-btn" onclick="addFormat('請分 3-5 個重點說明。')">分點說明</button>
                            <button class="format-btn" onclick="addFormat('請以步驟式方式說明。')">步驟說明</button>
                            <button class="format-btn" onclick="addFormat('請以問答形式呈現。')">問答形式</button>
                            <button class="format-btn" onclick="addFormat('請進行優缺點比較。')">比較對照</button>
                        </div>
                    </div>
                    
                    <div class="tab-panel" id="tab-style">
                        <div class="format-buttons">
                            <button class="format-btn" onclick="addFormat('請使用專業術語進行說明。')">專業術語</button>
                            <button class="format-btn" onclick="addFormat('請用淺顯易懂的方式說明。')">淺顯易懂</button>
                            <button class="format-btn" onclick="addFormat('請以商業報告的格式呈現。')">商業報告</button>
                            <button class="format-btn" onclick="addFormat('請以學術論文的風格撰寫。')">學術風格</button>
                        </div>
                    </div>
                    
                    <div class="tab-panel" id="tab-special">
                        <div class="format-buttons">
                            <button class="format-btn" onclick="addFormat('請提供具體例子說明。')">包含例子</button>
                            <button class="format-btn" onclick="addFormat('請盡量提供相關數據支持。')">數據支持</button>
                            <button class="format-btn" onclick="addFormat('請評估可行性並說明風險。')">可行性分析</button>
                            <button class="format-btn" onclick="addFormat('請提供行動建議。')">行動建議</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <div class="chatgpt-button-group">
                <button class="btn-action btn-chatgpt" onclick="openInChatGPT()">💬 在ChatGPT中開啟</button>
                <button class="btn-model-selector" onclick="toggleModelSelector()">▼</button>
                <div class="model-selector-dropdown" id="modelSelector">
                    <div class="model-option" data-model="o4-mini">o4-mini</div>
                    <div class="model-option" data-model="gpt-4o">GPT-4o</div>
                    <div class="model-option" data-model="gpt-4o-mini">GPT-4o mini</div>
                    <div class="model-option" data-model="gpt-4">GPT-4</div>
                </div>
                <div class="selected-model-display">o4-mini</div>
            </div>
            <button class="btn-action btn-copy" onclick="copyResult()">📋 複製結果</button>
            <button class="btn-action btn-clear" onclick="clearFormats()">🎨 清除格式</button>
            <button class="btn-action btn-clear" onclick="clearAll()">🗑️ 清空全部</button>
        </div>
    </div>

    <!-- 模板編輯 Modal -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <h3>✏️ 編輯 Prompt 模板</h3>
            
            <div class="example-selector">
                <h4>📚 快速選取範例：</h4>
                <select id="exampleSelector" onchange="loadExample()">
                    <option value="">── 選擇範例模板 ──</option>
                    <option value="商務場景.txt">💼 商務場景</option>
                    <option value="教育學習.txt">🎓 教育學習</option>
                    <option value="健康生活.txt">🏅 健康生活</option>
                    <option value="理財投資.txt">💰 理財投資</option>
                    <option value="料理烹飪.txt">🍳 料理烹飪</option>
                    <option value="旅遊規劃.txt">🌍 旅遊規劃</option>
                    <option value="創作設計.txt">🎨 創作設計</option>
                    <option value="技術支援.txt">🔧 技術支援</option>
                    <option value="談判溝通.txt">💬 談判溝通</option>
                </select>
            </div>
            <textarea id="templateInput" placeholder="請輸入你的 prompt 模板，用 [xxx] 標記需要填入的地方。

你可以：
• 直接輸入你的模板
• 使用上方下拉選單選擇範例模板
• 支持選項格式：[標籤，例如：選項A／選項B]

範例：
請幫我找出 [產品類型，例如：3C產品／服飾／食品] 在 [市場區域] 的使用行為與購買趨勢。"></textarea>
            
            <div class="example">
                <h4>使用說明：</h4>
                <p>在模板中用方括號 <code>[xxx]</code> 標記需要填入的部分，例如：</p>
                <code>請幫我找出 [產品類型] 在 [市場區域] 的使用行為與購買趨勢</code>
                <br><br>
                <p>支持選項格式： <code>[標籤，例如：選項A／選項B／選項C]</code></p>
                <p>當你使用選項格式時，點擊占位符會顯示快速選擇按鈕，讓填入更方便！</p>
                <p><strong>快捷鍵：</strong> Ctrl+C 複製結果、Ctrl+Enter 在 ChatGPT 中開啟</p>
            </div>
            
            <div class="url-share-section">
                <h4>🔗 分享模板</h4>
                <p style="color: #718096; font-size: 14px; margin-bottom: 10px;">
                    將你的模板打包成一個連結，分享給同事、朋友或團隊使用。<br>
                    他們點擊連結就能直接載入你的模板，無需重新輸入！
                </p>
                <button class="btn btn-share" onclick="copyTemplateUrl()">📋 複製分享連結</button>
            </div>
            
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeTemplateEditor()">取消</button>
                <button class="btn btn-primary" onclick="saveTemplate()">儲存模板</button>
            </div>
        </div>
    </div>

    <!-- 填入內容 Modal -->
    <div id="fillModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">填入內容</h3>
            <p id="modalHint" style="color: #718096; margin-bottom: 10px;"></p>
            <input type="text" id="modalInput" placeholder="請輸入內容...">
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeFillModal()">取消</button>
                <button class="btn btn-primary" onclick="confirmFill()">確認</button>
            </div>
        </div>
    </div>

    <!-- 通知 -->
    <div id="notification" class="notification">
        已複製到剪貼簿！
    </div>

    <script>
        let currentPlaceholderIndex = -1;
        let placeholders = [];
        let filledValues = {};
        let addedFormats = [];
        let currentTemplate = '';

        // 定義格式衝突規則
        const formatConflicts = {
            // 長度控制 - 互斥
            length: [
                '請以不超過 50 字簡潔回答。',
                '請以不超過 100 字說明。',
                '請提供詳細完整的分析。',
                '請提供重點摘要。'
            ],
            // 輸出格式 - 互斥
            outputFormat: [
                '請將結果以表格形式輸出。',
                '請將結果以條列式呈現。',
                '請將結果以 JSON 格式輸出。',
                '請以段落形式詳細說明。'
            ],
            // 結構要求 - 部分互斥
            structure: [
                '請分 3-5 個重點說明。',
                '請以步驟式方式說明。',
                '請以問答形式呈現。'
            ],
            // 語言風格 - 互斥
            style: [
                '請使用專業術語進行說明。',
                '請用淺顯易懂的方式說明。',
                '請以商業報告的格式呈現。',
                '請以學術論文的風格撰寫。'
            ]
        };

        const templateDisplay = document.getElementById('templateDisplay');
        const templateModal = document.getElementById('templateModal');
        const fillModal = document.getElementById('fillModal');
        const templateInput = document.getElementById('templateInput');
        const modalInput = document.getElementById('modalInput');
        const modalTitle = document.getElementById('modalTitle');
        const modalHint = document.getElementById('modalHint');

        // 自動調整 textarea 高度
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // 初始化
        loadDefaultTemplate();
        
        // 為 templateInput 添加自動調整高度的事件監聽
        templateInput.addEventListener('input', function() {
            autoResizeTextarea(this);
        });
        
        templateInput.addEventListener('paste', function() {
            setTimeout(() => autoResizeTextarea(this), 10);
        });

        function switchTab(tabId) {
            // 移除所有 tab 的 active 狀態
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            // 激活選中的 tab
            event.target.classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        function loadDefaultTemplate() {
            // 首先檢查 URL 參數是否有模板
            const urlParams = new URLSearchParams(window.location.search);
            const urlTemplate = urlParams.get('prompt');
            
            if (urlTemplate) {
                try {
                    // URLSearchParams 已經自動解碼了，不需要再次 decodeURIComponent
                    currentTemplate = urlTemplate;
                    templateInput.value = currentTemplate;
                    parseTemplate();
                    autoResizeTextarea(templateInput);
                    console.log('從 URL 載入模板:', currentTemplate);
                    return;
                } catch (error) {
                    console.error('解析 URL 參數失敗:', error);
                    // 如果解析失敗，繼續使用預設模板
                }
            }
            
            // 使用空白模板
            currentTemplate = '';
            templateInput.value = currentTemplate;
            parseTemplate();
        }

        // 範例模板內容
        const exampleTemplates = {
            '商務場景.txt': `請扮演 [角色，例如：資深業務經理 / 市場行銷專家 / 客戶關係經理]，協助我 [任務，例如：分析市場趨勢 / 制定行銷策略 / 提升客戶滿意度]。

請使用 [方法，例如：數據分析 / 競爭對手研究 / 客戶訪談] 來達成目標，並以 [輸出格式，例如：報告 / 簡報 / 行動計畫] 的形式呈現結果。`,
            
            '教育學習.txt': `我希望你成為我的 [教學角色，例如：程式設計導師／語言學習教練／數學解題助手]，幫助我學習 [學習主題，例如：Python程式設計／英文會話／微積分]。

請使用 [教學方法，例如：互動式問答／實作練習／案例分析] 來進行教學，並根據我的 [學習程度，例如：初學者／中級程度／進階學習者] 調整教學內容。

在教學過程中，請特別注意 [學習重點，例如：基礎概念理解／實際應用練習／解題技巧掌握]，並提供 [回饋方式，例如：即時糾正／階段性測驗／學習進度追蹤]。`,
            
            '健康生活.txt': `請扮演 [健康專家，例如：營養師 / 健身教練 / 心理健康顧問]，針對我的 [健康目標，例如：減重10公斤 / 增加肌肉量 / 改善睡眠品質] 提供建議。

考慮到我的 [個人情況，例如：工作繁忙 / 有運動習慣 / 偏好素食] 和 [時間限制，例如：每天30分鐘 / 週末才有時間 / 彈性安排]，請制定可行的計畫。

請提供 [建議類型，例如：飲食調整建議／運動訓練計畫／生活習慣改善]，並說明 [執行方式，例如：每日執行清單／週程安排／月度檢核]。`,
            
            '理財投資.txt': `我需要一位 [理財顧問，例如：投資分析師／財務規劃師／保險專家] 幫助我進行 [理財規劃，例如：退休規劃／子女教育基金／房屋購買計畫]。

我的 [風險承受度，例如：保守型／平衡型／積極型] 投資者，每月可投資金額為 [投資金額，例如：1萬元以下／1-3萬元／3萬元以上]，投資期間為 [投資期間，例如：短期(1-3年)／中期(3-10年)／長期(10年以上)]。

請提供 [投資建議，例如：資產配置建議／具體投資標的／風險控制策略]，並說明 [執行步驟，例如：開戶流程／投資時機／定期檢視]。`,
            
            '料理烹飪.txt': `請成為我的 [料理指導，例如：中式料理師傅／西式烹飪專家／烘焙達人]，教我製作 [料理類型，例如：家常菜／節慶料理／健康輕食]。

考慮到我的 [烹飪程度，例如：新手／有基礎／進階] 和 [設備限制，例如：只有電鍋／完整廚房／簡易設備]，請提供 [難度等級，例如：簡單易做／中等難度／挑戰性高] 的食譜。

請包含 [食譜內容，例如：詳細步驟／營養分析／變化建議] 和 [實用提醒，例如：食材挑選要點／保存方法／失敗處理]。`,
            
            '旅遊規劃.txt': `請扮演 [旅遊專家，例如：旅遊規劃師／當地導遊／背包客達人]，協助我規劃 [旅遊目的地，例如：日本關西／歐洲多國／東南亞] 的旅程。

我的旅遊類型是 [旅遊風格，例如：文化深度遊／美食探索／自然景觀／購物血拼]，預算範圍為 [預算，例如：經濟型／中等預算／豪華旅遊]，旅遊天數為 [天數，例如：3-5天／一週／10天以上]。

請提供 [旅遊規劃，例如：行程安排／住宿推薦／交通方式] 和 [實用資訊，例如：必買伴手禮／注意事項／緊急聯絡方式]。`,
            
            '創作設計.txt': `我希望你成為 [創意導師，例如：平面設計師／文案創作者／影片製作人]，指導我完成 [創作專案，例如：品牌LOGO設計／社群媒體文案／產品介紹影片]。

目標受眾是 [受眾群體，例如：年輕族群／專業人士／家庭用戶]，風格偏好為 [設計風格，例如：簡約現代／活潑有趣／專業穩重]，需要在 [時間限制，例如：本週內／一個月內／沒有急迫性] 完成。

請提供 [創作指導，例如：設計概念／創意發想／技術建議] 和 [執行細節，例如：工具推薦／流程安排／品質檢核]。`,
            
            '技術支援.txt': `請擔任 [技術專家，例如：程式開發者／系統管理員／資料分析師]，協助我解決 [技術問題，例如：程式除錯／系統優化／資料處理]。

我的技術背景是 [技術水平，例如：初學者／有基礎／資深工程師]，使用的技術環境為 [技術環境，例如：Windows／Mac／Linux]，期望的解決方案格式為 [解決方案，例如：step-by-step教學／程式碼範例／架構建議]。

請提供 [技術指導，例如：問題分析／解決步驟／最佳實踐] 和 [學習資源，例如：相關文件／進階教材／社群推薦]。`,
            
            '談判溝通.txt': `我希望你成為我的 [角色，例如：資深談判教練／商務策略顧問／跨文化談判專家]，你的目標是協助我 [主要任務，例如：模擬即將進行的談判／制定談判策略／評估談判風險]，透過 [方法，例如：提問與討論／案例分析／角色扮演] 幫助我 [目的，例如：設計策略與掌握要點／預測對方立場／強化談判技巧]，並提醒我 [提醒事項，例如：檢視目標與可能的影響／關注談判時機／評估替代方案]。

你將按照以下方式進行對話：
1. 確認 [步驟一名稱，例如：談判主題確認／背景收集]：首先詢問並確認我希望模擬的 [主題，例如：薪資協商／合同談判／採購議價] 與 [背景情境，例如：初次面談／年度合約續簽／跨國交易]。
2. [步驟二名稱，例如：提問導向／深度探索]：根據設定的主題，透過提問幫助我深入思考 [策略要點，例如：底線設定／價值交換方案]、[對方立場，例如：利益關切／潛在顧慮]，必要時直接告訴我可能的 [解決方案，例如：讓步策略／替代提案]。
3. [步驟三名稱，例如：摘要與總結／關鍵回顧]：在適當時機進行簡短的摘要或總結，讓我清楚了解 [關鍵點，例如：核心利益／風險因素] 與 [可行策略，例如：進攻方案／防守選項]。`
        };

        function loadExample() {
            const selector = document.getElementById('exampleSelector');
            const selectedFile = selector.value;
            
            if (!selectedFile) {
                return;
            }
            
            const templateContent = exampleTemplates[selectedFile];
            if (templateContent) {
                currentTemplate = templateContent.trim();
                templateInput.value = currentTemplate;
                parseTemplate();
                autoResizeTextarea(templateInput);
                showNotification(`✅ 已載入「${selector.options[selector.selectedIndex].text.replace(/^\S+\s/, '')}」範例`);
            } else {
                showNotification('❌ 找不到範例模板', '#f56565');
            }
        }

        function openTemplateEditor() {
            templateModal.style.display = 'block';
            templateInput.focus();
            autoResizeTextarea(templateInput);
        }

        function closeTemplateEditor() {
            templateModal.style.display = 'none';
        }

        function saveTemplate() {
            currentTemplate = templateInput.value.trim();
            if (currentTemplate) {
                parseTemplate();
                closeTemplateEditor();
            }
        }

        function parseTemplate() {
            if (!currentTemplate) {
                templateDisplay.innerHTML = '<div class="empty-template">請點擊「編輯模板」開始設定你的 prompt 模板，或使用編輯器中的範例選擇器...</div>';
                return;
            }

            // 重置填入值但保留格式
            filledValues = {};
            
            // 找出所有占位符
            const placeholderRegex = /\[([^\]]+)\]/g;
            placeholders = [];
            let match;
            
            while ((match = placeholderRegex.exec(currentTemplate)) !== null) {
                const content = match[1];
                const placeholder = {
                    full: match[0],
                    content: content,
                    index: placeholders.length
                };
                
                // 檢查是否包含選項（以 ／ 或 / 分隔）
                if (content.includes('／') || content.includes('/')) {
                    const parts = content.split('，');
                    if (parts.length >= 2) {
                        placeholder.label = parts[0];
                        const optionPart = parts.slice(1).join('，');
                        if (optionPart.includes('例如：')) {
                            const examplePart = optionPart.split('例如：')[1];
                            if (examplePart) {
                                // 同時支援全形和半形斜線分隔
                                const options = examplePart.includes('／') ? 
                                    examplePart.split('／') : 
                                    examplePart.split('/');
                                placeholder.options = options.map(opt => opt.trim().replace(/[\[\]]/g, ''));
                                placeholder.hasOptions = true;
                            }
                        }
                    }
                }
                
                placeholders.push(placeholder);
            }

            renderTemplate();
        }

        function renderTemplate() {
            let template = currentTemplate;
            
            placeholders.forEach((placeholder, index) => {
                const value = filledValues[index];
                let displayText;
                let titleText;
                
                if (placeholder.hasOptions && placeholder.label) {
                    displayText = value || placeholder.label;
                    titleText = `點擊填入: ${placeholder.label}`;
                } else {
                    displayText = value || placeholder.content;
                    titleText = `點擊填入: ${placeholder.content}`;
                }
                
                const isFilledClass = value ? 'filled' : '';
                const span = `<span class="placeholder ${isFilledClass}" onclick="openFillModal(${index})" title="${titleText}">${displayText}</span>`;
                template = template.replace(placeholder.full, span);
            });

            // 將換行符轉換為 HTML 換行標籤
            template = template.replace(/\n/g, '<br>');

            // 添加格式要求
            if (addedFormats.length > 0) {
                template += '<br><br>';
                addedFormats.forEach((format, index) => {
                    template += `<div class="added-format">${format}<button class="remove-format" onclick="removeFormat(${index})" title="移除此格式">×</button></div>`;
                });
            }

            templateDisplay.innerHTML = template;
            updateButtonStates();
        }

        function openFillModal(index) {
            currentPlaceholderIndex = index;
            const placeholder = placeholders[index];
            
            // 清空之前的內容
            const modalContent = fillModal.querySelector('.modal-content');
            const existingOptions = modalContent.querySelector('.option-buttons');
            if (existingOptions) {
                existingOptions.remove();
            }
            
            const displayText = placeholder.label || placeholder.content;
            modalTitle.textContent = `填入：${displayText}`;
            modalHint.textContent = `請為「${displayText}」輸入具體內容`;
            modalInput.value = filledValues[index] || '';
            
            // 如果有選項，添加選項按鈕
            if (placeholder.hasOptions && placeholder.options) {
                const optionContainer = document.createElement('div');
                optionContainer.className = 'option-buttons';
                optionContainer.style.cssText = `
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                    gap: 8px;
                    margin: 15px 0;
                    padding: 15px;
                    background: #f8fafc;
                    border-radius: 8px;
                    border: 1px solid #e2e8f0;
                `;
                
                const optionTitle = document.createElement('div');
                optionTitle.textContent = '快速選擇：';
                optionTitle.style.cssText = `
                    grid-column: 1 / -1;
                    font-size: 14px;
                    font-weight: 500;
                    color: #4a5568;
                    margin-bottom: 8px;
                `;
                optionContainer.appendChild(optionTitle);
                
                placeholder.options.forEach(option => {
                    const optionBtn = document.createElement('button');
                    optionBtn.textContent = option;
                    optionBtn.className = 'option-btn';
                    optionBtn.style.cssText = `
                        padding: 8px 12px;
                        border: 2px solid #e2e8f0;
                        background: white;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 13px;
                        font-weight: 500;
                        color: #4a5568;
                        transition: all 0.2s ease;
                    `;
                    
                    optionBtn.addEventListener('mouseenter', () => {
                        optionBtn.style.borderColor = '#667eea';
                        optionBtn.style.background = '#f7fafc';
                        optionBtn.style.color = '#667eea';
                    });
                    
                    optionBtn.addEventListener('mouseleave', () => {
                        optionBtn.style.borderColor = '#e2e8f0';
                        optionBtn.style.background = 'white';
                        optionBtn.style.color = '#4a5568';
                    });
                    
                    optionBtn.addEventListener('click', () => {
                        modalInput.value = option;
                        modalInput.focus();
                    });
                    
                    optionContainer.appendChild(optionBtn);
                });
                
                // 添加「其他」選項
                const otherBtn = document.createElement('button');
                otherBtn.textContent = '其他...';
                otherBtn.className = 'option-btn';
                otherBtn.style.cssText = `
                    padding: 8px 12px;
                    border: 2px solid #fbbf24;
                    background: #fef3c7;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 13px;
                    font-weight: 500;
                    color: #92400e;
                    transition: all 0.2s ease;
                `;
                
                otherBtn.addEventListener('mouseenter', () => {
                    otherBtn.style.borderColor = '#f59e0b';
                    otherBtn.style.background = '#fde68a';
                });
                
                otherBtn.addEventListener('mouseleave', () => {
                    otherBtn.style.borderColor = '#fbbf24';
                    otherBtn.style.background = '#fef3c7';
                });
                
                otherBtn.addEventListener('click', () => {
                    modalInput.value = '';
                    modalInput.focus();
                });
                
                optionContainer.appendChild(otherBtn);
                
                const inputElement = modalContent.querySelector('#modalInput');
                inputElement.parentNode.insertBefore(optionContainer, inputElement);
            }
            
            fillModal.style.display = 'block';
            setTimeout(() => modalInput.focus(), 100);
        }

        function closeFillModal() {
            fillModal.style.display = 'none';
            currentPlaceholderIndex = -1;
        }

        function confirmFill() {
            const value = modalInput.value.trim();
            
            if (value && currentPlaceholderIndex >= 0) {
                filledValues[currentPlaceholderIndex] = value;
                renderTemplate();
            }
            
            closeFillModal();
        }

        function addFormat(formatText) {
            // 檢查是否已經存在完全相同的格式
            if (addedFormats.includes(formatText)) {
                return;
            }

            // 檢查衝突並移除衝突的格式
            for (const [category, formats] of Object.entries(formatConflicts)) {
                if (formats.includes(formatText)) {
                    // 移除同類別的其他格式
                    addedFormats = addedFormats.filter(existing => !formats.includes(existing));
                    break;
                }
            }

            // 添加新格式
            addedFormats.push(formatText);
            renderTemplate();
            
            // 視覺反饋
            highlightFormatButton(formatText);
        }

        function highlightFormatButton(formatText) {
            const buttons = document.querySelectorAll('.format-btn');
            buttons.forEach(btn => {
                if (btn.textContent === getButtonText(formatText)) {
                    btn.style.background = 'linear-gradient(45deg, #48bb78, #38a169)';
                    btn.style.color = 'white';
                    btn.style.transform = 'scale(1.05)';
                    
                    setTimeout(() => {
                        btn.style.background = '';
                        btn.style.color = '';
                        btn.style.transform = '';
                        updateButtonStates(); // 確保狀態正確更新
                    }, 300);
                }
            });
        }

        function getButtonText(formatText) {
            const buttonMap = {
                '請將結果以表格形式輸出。': '表格格式',
                '請將結果以條列式呈現。': '條列清單',
                '請將結果以 JSON 格式輸出。': 'JSON格式',
                '請以段落形式詳細說明。': '段落說明',
                '請以不超過 50 字簡潔回答。': '50字內',
                '請以不超過 100 字說明。': '100字內',
                '請提供詳細完整的分析。': '詳細分析',
                '請提供重點摘要。': '重點摘要',
                '請分 3-5 個重點說明。': '分點說明',
                '請以步驟式方式說明。': '步驟說明',
                '請以問答形式呈現。': '問答形式',
                '請進行優缺點比較。': '比較對照',
                '請使用專業術語進行說明。': '專業術語',
                '請用淺顯易懂的方式說明。': '淺顯易懂',
                '請以商業報告的格式呈現。': '商業報告',
                '請以學術論文的風格撰寫。': '學術風格',
                '請提供具體例子說明。': '包含例子',
                '請盡量提供相關數據支持。': '數據支持',
                '請評估可行性並說明風險。': '可行性分析',
                '請提供行動建議。': '行動建議'
            };
            return buttonMap[formatText] || '';
        }

        function updateButtonStates() {
            const buttons = document.querySelectorAll('.format-btn');
            buttons.forEach(btn => {
                const formatText = getFormatTextFromButton(btn.textContent);
                if (addedFormats.includes(formatText)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function getFormatTextFromButton(buttonText) {
            const reverseButtonMap = {
                '表格格式': '請將結果以表格形式輸出。',
                '條列清單': '請將結果以條列式呈現。',
                'JSON格式': '請將結果以 JSON 格式輸出。',
                '段落說明': '請以段落形式詳細說明。',
                '50字內': '請以不超過 50 字簡潔回答。',
                '100字內': '請以不超過 100 字說明。',
                '詳細分析': '請提供詳細完整的分析。',
                '重點摘要': '請提供重點摘要。',
                '分點說明': '請分 3-5 個重點說明。',
                '步驟說明': '請以步驟式方式說明。',
                '問答形式': '請以問答形式呈現。',
                '比較對照': '請進行優缺點比較。',
                '專業術語': '請使用專業術語進行說明。',
                '淺顯易懂': '請用淺顯易懂的方式說明。',
                '商業報告': '請以商業報告的格式呈現。',
                '學術風格': '請以學術論文的風格撰寫。',
                '包含例子': '請提供具體例子說明。',
                '數據支持': '請盡量提供相關數據支持。',
                '可行性分析': '請評估可行性並說明風險。',
                '行動建議': '請提供行動建議。'
            };
            return reverseButtonMap[buttonText] || '';
        }

        function removeFormat(index) {
            addedFormats.splice(index, 1);
            renderTemplate();
        }

        function resetTemplate() {
            filledValues = {};
            renderTemplate();
        }

        function clearFormats() {
            addedFormats = [];
            renderTemplate();
        }

        function clearAll() {
            currentTemplate = '';
            templateInput.value = '';
            filledValues = {};
            placeholders = [];
            addedFormats = [];
            templateDisplay.innerHTML = '<div class="empty-template">請點擊「編輯模板」開始設定你的 prompt 模板...</div>';
        }

        function copyTemplateUrl() {
            const currentPrompt = templateInput.value.trim();
            if (!currentPrompt) {
                showNotification('⚠️ 請先輸入模板內容', '#f56565');
                return;
            }

            try {
                // URL encode 模板內容
                const encodedPrompt = encodeURIComponent(currentPrompt);
                const baseUrl = window.location.origin + window.location.pathname;
                const shareUrl = `${baseUrl}?prompt=${encodedPrompt}`;
                
                // 複製到剪貼簿
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        showNotification('🔗 分享連結已複製到剪貼簿！', '#0ea5e9');
                    }).catch((error) => {
                        console.error('Clipboard API failed:', error);
                        fallbackCopyToClipboard(shareUrl);
                    });
                } else {
                    fallbackCopyToClipboard(shareUrl);
                }
            } catch (error) {
                console.error('產生分享連結失敗:', error);
                showNotification('❌ 產生分享連結失敗', '#f56565');
            }
        }

        function fallbackCopyToClipboard(text) {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    showNotification('🔗 分享連結已複製到剪貼簿！', '#0ea5e9');
                } else {
                    showNotification('❌ 複製失敗，請手動複製', '#f56565');
                }
            } catch (error) {
                console.error('Fallback copy failed:', error);
                showNotification('❌ 複製失敗，請手動複製', '#f56565');
            }
        }

        // 全局變量存儲選中的模型
        let selectedModel = 'o4-mini';

        function generateResult() {
            let result = currentTemplate;
            
            placeholders.forEach((placeholder, index) => {
                const value = filledValues[index];
                if (value) {
                    result = result.replace(placeholder.full, value);
                }
            });

            // 添加格式要求到結果中
            if (addedFormats.length > 0) {
                result += '\n\n' + addedFormats.join(' ');
            }

            return result;
        }

        function toggleModelSelector() {
            const dropdown = document.getElementById('modelSelector');
            dropdown.classList.toggle('show');
        }

        function selectModel(model) {
            selectedModel = model;
            document.querySelector('.selected-model-display').textContent = model;
            
            // 更新選中狀態
            document.querySelectorAll('.model-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-model="${model}"]`).classList.add('selected');
            
            // 隱藏下拉選單
            document.getElementById('modelSelector').classList.remove('show');
        }

        // 初始化模型選擇器
        function initModelSelector() {
            // 設定預設選中狀態
            document.querySelector('[data-model="o4-mini"]').classList.add('selected');
            
            // 為每個選項添加點擊事件
            document.querySelectorAll('.model-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectModel(this.dataset.model);
                });
            });
            
            // 點擊外部關閉下拉選單
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.chatgpt-button-group')) {
                    document.getElementById('modelSelector').classList.remove('show');
                }
            });
        }

        function openInChatGPT() {
            const result = generateResult();
            
            if (!result.trim()) {
                showNotification('⚠️ 請先設定模板並填入內容', '#f56565');
                return;
            }
            
            // URL encode the result
            const encodedPrompt = encodeURIComponent(result);
            const chatGPTUrl = `https://chatgpt.com/?model=${selectedModel}&q=${encodedPrompt}`;
            
            // Open in new tab
            window.open(chatGPTUrl, '_blank');
            showNotification(`💬 已在新分頁開啟 ChatGPT (${selectedModel})！`);
        }

        function copyResult() {
            const result = generateResult();

            // 複製到剪貼簿
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(result).then(() => {
                    showNotification('📋 已複製到剪貼簿！');
                }).catch((error) => {
                    console.error('Clipboard API failed:', error);
                    fallbackCopyToClipboard(result);
                });
            } else {
                fallbackCopyToClipboard(result);
            }
        }

        // 鍵盤快捷鍵
        document.addEventListener('keydown', (e) => {
            // ESC 關閉 modal
            if (e.key === 'Escape') {
                if (fillModal.style.display === 'block') {
                    closeFillModal();
                }
                if (templateModal.style.display === 'block') {
                    closeTemplateEditor();
                }
            }
            
            // Enter 確認
            if (e.key === 'Enter') {
                if (fillModal.style.display === 'block') {
                    confirmFill();
                } else if (templateModal.style.display === 'block' && e.ctrlKey) {
                    saveTemplate();
                }
            }
            
            // Ctrl+C 複製結果
            if (e.ctrlKey && e.key === 'c' && fillModal.style.display !== 'block' && templateModal.style.display !== 'block') {
                if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    copyResult();
                }
            }
            
            // Ctrl+Enter 在 ChatGPT 中開啟
            if (e.ctrlKey && e.key === 'Enter' && fillModal.style.display !== 'block' && templateModal.style.display !== 'block') {
                if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    openInChatGPT();
                }
            }
        });

        // 點擊 modal 外部關閉
        fillModal.addEventListener('click', (e) => {
            if (e.target === fillModal) {
                closeFillModal();
            }
        });

        templateModal.addEventListener('click', (e) => {
            if (e.target === templateModal) {
                closeTemplateEditor();
            }
        });

        // 顯示通知
        function showNotification(message, color = '#48bb78') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = color;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 頁面載入時初始化模型選擇器
        document.addEventListener('DOMContentLoaded', function() {
            initModelSelector();
        });
    </script>
    
    <!-- Version Footer -->
    <div style="text-align: center; margin-top: 20px; padding: 10px; color: #888; font-size: 12px; border-top: 1px solid #eee;">
        版本 v0.3.2
    </div>
</body>
</html>